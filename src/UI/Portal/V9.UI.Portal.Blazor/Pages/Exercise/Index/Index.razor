@page "/exercise/{Name}"
@using V9.UI.Portal.Services.Skeletal.Contracts
@using V9.UI.Portal.Services.Skeletal.Views

@inject ISkeletalClient Client

<div class="container d-flex justify-content-center pb-5 w-75">
    <div class="row">
        <div class="col-8 text-white">
            <span class="px-2 fw-bold" style="border-radius: 7px;background-color: #FF592C;">CALISTHENICS</span>
            @if (_exercise is not null && (DateTime.Now - _exercise.CreatedOn).TotalDays < 7)
            {
                <span class="px-2 fw-bold ms-2" style="border-radius: 7px;background-color: #45B26B;">NEW RELEASE</span>
            }

            <h1>@_exercise?.Name</h1>
            <p class="h4 pb-3 w-75" style="color: #777E90;">
                Building your theoretical knowledge to prevent injuries to and boost overall performance<br><br>
            </p>
            @if (false)
            {
                <video src="@BytesToBase64Video(_exercise?.Video)"/>
                
            }
            else
            {
                <p class="text-muted">Sorry for the inconvenience, our administrators have not yet uploaded a video for this exercise.</p>
            }
        </div>
        <div class="col text-white d-flex flex-column justify-content-evenly">
            <div class="table-responsive">
                <table class="table">
                    <thead class="text-white">
                    <tr></tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="border-0" style="color: #777E90;">
                            <span style="vertical-align: text-bottom;">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -32 576 576" width="1em" height="1em" fill="currentColor" class="me-1">
                                    <path d="M568.1 196.3l-22.62-22.62c-4.533-4.533-10.56-7.029-16.97-7.029s-12.44 2.496-16.97 7.029l-5.654 5.656l-20.12-20.12c4.596-23.46-2.652-47.9-19.47-64.73l-45.25-45.25C390.2 17.47 347.1 0 303.1 0C258.2 0 216 17.47 184.3 49.21L176.5 57.05L272.5 105.1v13.81c0 18.95 7.688 37.5 21.09 50.91l49.16 49.14c13.44 13.45 31.39 20.86 50.54 20.86c4.758 0 9.512-.4648 14.18-1.387l20.12 20.12l-5.654 5.654c-9.357 9.357-9.357 24.58-.002 33.94l22.62 22.62c4.535 4.533 10.56 7.031 16.97 7.031s12.44-2.498 16.97-7.031l90.53-90.5C578.3 220.8 578.3 205.6 568.1 196.3zM270.9 192.4c-3.846-3.846-7.197-8.113-10.37-12.49l-239.5 209.2c-28.12 28.12-28.16 73.72-.0371 101.8C35.12 505 53.56 512 71.1 512s36.84-7.031 50.91-21.09l209.1-239.4c-4.141-3.061-8.184-6.289-11.89-9.996L270.9 192.4z"></path>
                                </svg>
                            </span>Muscles worked
                        </td>
                        <td class="text-white border-0">@_exercise?.TargetNames.Count</td>
                    </tr>
                    <tr>
                        <td class="border-0" style="color: #777E90;">
                            <span style="vertical-align: text-bottom;">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor" class="me-1">
                                    <path d="M362.7 19.32C387.7-5.678 428.3-5.678 453.3 19.32L492.7 58.75C517.7 83.74 517.7 124.3 492.7 149.3L444.3 197.7L314.3 67.72L362.7 19.32zM421.7 220.3L188.5 453.4C178.1 463.8 165.2 471.5 151.1 475.6L30.77 511C22.35 513.5 13.24 511.2 7.03 504.1C.8198 498.8-1.502 489.7 .976 481.2L36.37 360.9C40.53 346.8 48.16 333.9 58.57 323.5L291.7 90.34L421.7 220.3z"></path>
                                </svg>
                            </span>Author
                        </td>
                        <td class="text-white border-0">@($"@{_exercise?.AuthorName}")</td>
                    </tr>
                    <tr>
                        <td class="border-0" style="color: #777E90;">
                            <span style="vertical-align: text-bottom;">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="-64 0 512 512" width="1em" height="1em" fill="currentColor" class="me-1">
                                    <path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"></path>
                                </svg>
                            </span>Difficulty
                        </td>
                        <td class="border-0" style="color: #45B26B;">@_exercise?.Difficulty</td>
                    </tr>
                    <tr>
                        <td class="border-0" style="color: #777E90;">
                            <span style="vertical-align: text-bottom;">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor" class="me-1">
                                    <path d="M510.3 445.9L437.3 153.8C433.5 138.5 420.8 128 406.4 128H346.1c3.625-9.1 5.875-20.75 5.875-32c0-53-42.1-96-96-96S159.1 43 159.1 96c0 11.25 2.25 22 5.875 32H105.6c-14.38 0-27.13 10.5-30.88 25.75l-73.01 292.1C-6.641 479.1 16.36 512 47.99 512h416C495.6 512 518.6 479.1 510.3 445.9zM256 128C238.4 128 223.1 113.6 223.1 96S238.4 64 256 64c17.63 0 32 14.38 32 32S273.6 128 256 128z"></path>
                                </svg>
                            </span>Weighted
                        </td>
                        <td class="text-white border-0">
                            @if (_exercise is not null)
                            {
                                <div>@(_exercise.IsWeighted ? "Yes" : "No")</div>
                            }
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <hr style="color: #777E90;">
            <p>
                <span style="color: rgb(230, 232, 236);">@_exercise?.Description</span>
            </p>
            <p>
                <span style="color: rgb(230, 232, 236);">Make sure you follow:</span>
            </p>
            <div class="p-4" style="border-radius: 15px;border: solid 2px #353945;">

                @if (_exercise is not null)
                {
                    foreach (var step in _exercise.ExecutionSteps)
                    {
                        <p class="text-white fw-bold">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor" style="color: #45B26B;vertical-align: baseline;">
                                <path d="M243.8 339.8C232.9 350.7 215.1 350.7 204.2 339.8L140.2 275.8C129.3 264.9 129.3 247.1 140.2 236.2C151.1 225.3 168.9 225.3 179.8 236.2L224 280.4L332.2 172.2C343.1 161.3 360.9 161.3 371.8 172.2C382.7 183.1 382.7 200.9 371.8 211.8L243.8 339.8zM512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM256 48C141.1 48 48 141.1 48 256C48 370.9 141.1 464 256 464C370.9 464 464 370.9 464 256C464 141.1 370.9 48 256 48z"></path>
                            </svg>&nbsp;@step
                        </p>
                    }
                }

            </div>
        </div>
    </div>
</div>

@code {

    [Parameter]
    public string Name { get; set; }

    private ExerciseView? _exercise;

    protected override async Task OnInitializedAsync()
    {
        var response = await Client.GetExerciseByNameAsync(Name);
        if (response.IsSuccessStatusCode)
        {
            _exercise = response.Content;
            StateHasChanged();
        }
    }

    private string BytesToBase64Video(byte[]? videoBytes) => 
        videoBytes is not null ? $"data:video/mp4;base64,{Convert.ToBase64String(videoBytes)}" : "";
}